name: Update meta
on:
  schedule:
    - cron: '0 * * * *' # every hour
jobs:
  job:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true
          ref: meta
      - uses: earthly/actions-setup@v1
        with:
          version: "v0.6.13"
      - name: Import gpg key
        run: |
          echo "${#CBCA760DC1170A9B}"
          echo "$CBCA760DC1170A9B" | gpg --import
        env:
          CBCA760DC1170A9B: ${{ secrets.CBCA760DC1170A9B }}
      - run: earthly +syncFacebook
      - run: earthly +git.js
      - run: node git.js rebase-commit-push "Charley Wong's bot <charleywong-bot@giffon.io>" "CBCA760DC1170A9B!" "https://${GITHUB_ACTOR}:${GITHUB_TOKEN}@github.com/giffon/charleywong.git" meta
        env:
          GITHUB_ACTOR: ${{ secrets.GITHUB_ACTOR }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          FACEBOOK_TOKEN: ${{ secrets.FACEBOOK_TOKEN }}
